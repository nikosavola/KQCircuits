

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Macro development &mdash; KQCircuits 2019 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Exports" href="export/index.html" />
    <link rel="prev" title="Point-and-click workflow tutorial" href="gui_workflow.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> KQCircuits
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../start/index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gui_features.html">GUI Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_workflow.html">Point-and-click workflow tutorial</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Macro development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-workflow">Basic workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugger">Debugger</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reloading-libraries">Reloading libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="export/index.html">Exports</a></li>
<li class="toctree-l2"><a class="reference internal" href="xsection.html">Creating cross section images</a></li>
<li class="toctree-l2"><a class="reference internal" href="terminology.html">Terminology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libraries/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/kqcircuits.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trademarks.html">Trademarks</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">KQCircuits</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
      <li>Macro development</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user_guide/macro_workflow.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="macro-development">
<h1>Macro development<a class="headerlink" href="#macro-development" title="Permalink to this headline">¶</a></h1>
<p>KLayout macros are Python scripts which can be run inside KLayout Editor.
They can be used, for example, to create or modify elements in the layout,
measure properties of cells, or export data from the layout. See also the
KLayout documentation about <a class="reference external" href="https://www.klayout.de/doc-qt5/about/macro_editor.html">macro development</a> and
<a class="reference external" href="https://www.klayout.de/doc-qt5/programming/index.html">programming scripts</a>
, and the <a class="reference external" href="https://www.klayout.de/doc-qt5/code/index.html">KLayout API documentation</a>.</p>
<div class="section" id="basic-workflow">
<h2>Basic workflow<a class="headerlink" href="#basic-workflow" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Open the KLayout application</p></li>
<li><p>From the top menu, choose “Macros” and “Macro Development”, or press F5.</p></li>
<li><p>Select “Python”</p></li>
<li><p>Open “[Local - python branch]”, where you should see the “kqcircuits scripts”
directory</p></li>
<li><p>Open <code class="docutils literal notranslate"><span class="pre">kqcircuits</span> <span class="pre">scripts/macros/generate/demo_placing_a_pcell</span></code></p></li>
<li><p>Click on the green play symbol with the exclamation mark (“Run script
from the current tab”), or use Shift+F5.</p></li>
<li><p>A chip cell should appear in the main KLayout window.</p></li>
</ol>
</div>
<div class="section" id="debugger">
<h2>Debugger<a class="headerlink" href="#debugger" title="Permalink to this headline">¶</a></h2>
<p>KLayout macros can be debugged using the debugger in the macro IDE. The
debugger can be toggled on/off using the “bug icon” at the top.</p>
<ul>
<li><p>Basic debugger workflow</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Place breakpoint in the code (red circle icon or F9).</p></li>
<li><p>Run the macro.</p></li>
<li><p>Execution will stop at the breakpoint. The values of all variables at
that point are now visible in the “Local variables” panel. You can also
double-click on the lines in the “Call stack” panel, to see variable
values at other stages of the call stack.</p></li>
<li><p>Can place more breakpoints, and the macro will stop at the next one
when you run the macro again.</p></li>
<li><p>Can also use the “Step over” and “Step into” buttons (icons with
arrows inside files or F) to go through the code step-by-step.</p></li>
</ol>
</div></blockquote>
</li>
<li><p>If an exception is raised when running a macro, you will get a pop-up
error window. By pressing “Cancel”, you will get the debugger view at the
point where the exception was raised, as if there was a breakpoint there.</p></li>
<li><p>PCells can sometimes have errors in their code, which will be visible in
the layout as missing parts and an asterisk at the end of the cell name.
These errors can be caught by having the macro window open and debugger on
when the PCell is placed into the layout.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>For this to work the PCell must be created from instance menu on
the top. If the PCell is dragged from “Libraries” panel, KLayout will
become unresponsive after the error is caught.</p></li>
<li><p>Errors will not be caught if creating a new PCell with the exact same
parameters as a previous one, because the PCell code runs only the first
time it is created.</p></li>
</ul>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The debugger will slow down code execution, so it can make sense
to disable it when running heavy macros.</p>
</div>
</div>
<div class="section" id="reloading-libraries">
<h2>Reloading libraries<a class="headerlink" href="#reloading-libraries" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Even though you have changed some line inside a PCell file, if
nothing changes on the generated design inside the editor, you have to re-run
the <code class="docutils literal notranslate"><span class="pre">reload.lym</span></code> file to be able to reload the library features for
changes to be updated. The reload macro can also be run from
“Edit -&gt; KQCircuits Library -&gt; Reload libraries” in the main KLayout window</p></li>
<li><p>The libraries are automatically reloaded whenever you restart KLayout, so
in that case there is no need to run the <code class="docutils literal notranslate"><span class="pre">reload</span></code> macro to see changes.</p></li>
<li><p>There may be problems with running the <code class="docutils literal notranslate"><span class="pre">reload</span></code> macro on some systems.
It can cause KLayout to crash or new cells to not work properly. If
this happens, you should re-launch the KLayout Editor.</p></li>
</ul>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Locate the <code class="docutils literal notranslate"><span class="pre">demo_placing_a_pcell</span></code> and <code class="docutils literal notranslate"><span class="pre">demo_pya_basic</span></code> tutorials
under <code class="docutils literal notranslate"><span class="pre">kqcircuits/macros/generate</span></code> directory. Use the tutorials to
have basic understanding about KLayout Editor and macro generation
concept.</p></li>
<li><p>Some other macros, such as <code class="docutils literal notranslate"><span class="pre">test_waveguide_composite</span></code> and
<code class="docutils literal notranslate"><span class="pre">test_wgc_airbridge</span></code>, can be useful to learn more about specific KQC
elements.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="export/index.html" class="btn btn-neutral float-right" title="Exports" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="gui_workflow.html" class="btn btn-neutral float-left" title="Point-and-click workflow tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019-2021, IQM.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>